<main class="dashboard">
  <img [src]="imagePath" alt="Danger" width="200px" style="display:flex; margin:auto;" />
  <!-- <h1 class="title">üî• ThermoGuard </h1> -->

  <div class="sensor-cards-container" style="margin-top: 10px;">
    <ng-container *ngIf="groupedSensors && groupedSensors.length > 0; else noSensors">
      <section class="sensor-card" *ngFor="let sensorGroup of groupedSensors">
        <h5 class="sensor-title">
          üñ•Ô∏è ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå: <b>{{ sensorGroup.mac_id }}</b>
        </h5>
        <!-- Gauge Section -->
        <section class="gauge-section">
          <div class="gauge">
            <div class="gauge-bg"></div>
            <div
              class="gauge-fill"
              [style.transform]="getRotation(sensorGroup.latest.temperature)"
            [style.background]="getHeatFlag(sensorGroup.latest.heat_index).color"
            ></div>
            <div class="gauge-center">
              <h2>{{ sensorGroup.latest.temperature | number : '1.2-2' }}¬∞C</h2>
              <p>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: {{ sensorGroup.latest.humidity | number : '1.2-2' }}%</p>
              <p>
                <b [style.color]="getHeatFlag(sensorGroup.latest.heat_index).color">
                  ‡∏î‡∏±‡∏ä‡∏ô‡∏µ: {{ sensorGroup.latest.heat_index | number : '1.2-2' }}¬∞C
                </b>
              </p>
              <div class="heat-flag">
                {{ getHeatFlag(sensorGroup.latest.heat_index).label }}
              </div>
            </div>
          </div>
        </section>
        <!-- History Section -->
        <section class="history">
          <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ </h3>
          <table
            class="history-table"
            *ngIf="sensorGroup.history && sensorGroup.history.length > 0; else noData"
          >
            <thead>
              <tr>
                <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                <th>‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô %)</th>
                <th>‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô (¬∞C)</th>
              </tr>
            </thead>
            <tbody>
              <tr
  *ngFor="let record of sensorGroup.history"
  [ngClass]="{
    'danger-row': getHeatFlag(record.heat_index).label === '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢' || 
                  getHeatFlag(record.heat_index).label === '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏™‡∏π‡∏á'
  }"
>
  <td>{{ record.recorded_at }}</td>
  <td>{{ record.temperature | number: '1.2-2' }}¬∞C / {{ record.humidity | number: '1.2-2' }}%</td>
  <td>{{ record.heat_index | number: '1.2-2' }}¬∞C</td>
</tr>
            </tbody>
          </table>
          <ng-template #noData>
            <p>No history available for this sensor.</p>
          </ng-template>
        </section>
      </section>
    </ng-container>

    <ng-template #noSensors>
      <p class="no-data-message">No sensor data received yet.</p>
    </ng-template>
  </div>
  <footer class="footer">
    <!-- <p>IoT Environment Dashboard ¬© 2025</p> -->
  </footer>
</main>
