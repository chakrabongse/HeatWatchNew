<main class="dashboard">
  <h1 class="title">ğŸ”¥ à¹‚à¸£à¸‡à¸à¸¢à¸²à¸šà¸²à¸¥à¸„à¹ˆà¸²à¸¢à¸ˆà¸±à¸à¸£à¸à¸‡à¸©à¹Œ</h1>

  <div class="sensor-cards-container">
    <ng-container *ngIf="groupedSensors && groupedSensors.length > 0; else noSensors">
      <section
        class="sensor-card"
        *ngFor="let sensorGroup of groupedSensors"
      >
        <h5 class="sensor-title">ğŸ–¥ï¸ Device: <b>{{ sensorGroup.mac_id }}</b></h5>

        <!-- Gauge Section -->
        <section class="gauge-section">
          <div class="gauge">
            <div class="gauge-bg"></div>
            <div
              class="gauge-fill"
              [style.transform]="getRotation(sensorGroup.latest.temperature)"
              [style.background]="getGradient(sensorGroup.latest.temperature, sensorGroup.latest.humidity)"
            ></div>
            <div class="gauge-center">
              <h2>{{ sensorGroup.latest.temperature | number: '1.2-2' }}Â°C</h2>
              <p>Humidity: {{ sensorGroup.latest.humidity | number: '1.2-2' }}%</p>
              <p>
                <b [style.color]="getHeatFlag(sensorGroup.latest.heat_index).color">
                  HI: {{ sensorGroup.latest.heat_index | number: '1.2-2' }}Â°C
                </b>
              </p>
              <div class="heat-flag">
                {{ getHeatFlag(sensorGroup.latest.heat_index).label }}
              </div>
            </div>
          </div>
        </section>

        <!-- History Section -->
        <section class="history">
          <h3>ğŸ“œ History (24h)</h3>
          <table class="history-table" *ngIf="sensorGroup.history && sensorGroup.history.length > 0; else noData">
            <thead>
              <tr><th>Time</th><th>Temp (Â°C / Hum %)</th><th>Heat Index (Â°C)</th></tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of sensorGroup.history">
                <td>{{ record.recorded_at }}</td>
                <td>{{ record.temperature | number: '1.2-2' }}Â°C / {{ record.humidity | number: '1.2-2' }}%</td>
                <td>{{ record.heat_index | number: '1.2-2' }}Â°C</td>
              </tr>
            </tbody>
          </table>
          <ng-template #noData>
            <p>No history available for this sensor.</p>
          </ng-template>
        </section>
      </section>
    </ng-container>

    <ng-template #noSensors>
      <p class="no-data-message">No sensor data received yet.</p>
    </ng-template>
  </div>

  <footer class="footer">
    <!-- <p>IoT Environment Dashboard Â© 2025</p> -->
  </footer>
</main>
